import{r as p}from"./index-8db94870.js";import{b}from"./http-8318f289.js";import{a as l,p as I,c as x}from"./cartItemsState-c47f54f4.js";const T=""+new URL("example-product-bbb774cf.jpg",import.meta.url).href,d=Symbol("NotExists");class y{constructor(e){this.fn=e,this.data=d,this.error=d,this.promise=this.fn(),this.promise.then(r=>{this.data=r}).catch(r=>{this.error=r,console.error(r)})}toPromise(){return this.promise}unwrap(){if(this.error!==d)throw this.error;if(this.data===d)throw this.promise;return this.data}}const h=t=>{const[e,r]=p.useState(null);return{future:e,mutate:(...o)=>{const i=new y(()=>t(...o));return r(i),i.toPromise()}}},E=()=>{const t=h(async s=>{var u;const o=await l.post("/cart-items",{productId:s}).acceptOrThrow(201);return Number((u=String(o.headers.location).match(/(\d+)$/))==null?void 0:u.at(0))}),e=h(async(s,o)=>{await l.patch(I("/cart-items/:cartItemId",s),{quantity:o}).acceptOrThrow(200)}),r=h(async s=>{await l.delete(I("/cart-items/:cartItemId",s)).acceptOrThrow(204)});return{createCartItem:t,updateCartItemQuantity:e,deleteCartItem:r}},F=()=>{const[t,e]=b(x),{createCartItem:r,updateCartItemQuantity:s,deleteCartItem:o}=E(),i=p.useCallback(c=>t.find(a=>a.product.id===c)??null,[t]),u=p.useCallback(async(c,a)=>{const n=i(c.id);if(a<=0){n&&o.mutate(n.id),e(m=>m.filter(C=>C.product.id!==c.id));return}if(n){s.mutate(n.id,a),e(t.map(m=>m.id===n.id?{...m,quantity:a}:m));return}const w=await r.mutate(c.id);e([...t,{id:w,product:c,quantity:a,unselectedForOrder:!1}])},[t,e,i,r,s,o]),{mutate:f}=h(async c=>{e(a=>a.filter(n=>!c.includes(n.id))),await Promise.all(c.map(a=>l.delete(I("/cart-items/:cartItemId",a)).acceptOrThrow(204)))});return{cartItems:t,findCartItemByProductId:i,setQuantity:u,deleteCartItems:f}};export{T as E,F as u};
//# sourceMappingURL=useCartActions-130fc0b2.js.map
