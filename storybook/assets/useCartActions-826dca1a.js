import{r as I}from"./index-8db94870.js";import{b as y}from"./http-8318f289.js";import{a as h,p,c as b}from"./cartItemsState-c47f54f4.js";const d=Symbol("NotExists");class x{constructor(e){this.fn=e,this.data=d,this.error=d,this.promise=this.fn(),this.promise.then(r=>{this.data=r}).catch(r=>{this.error=r,console.error(r)})}toPromise(){return this.promise}unwrap(){if(this.error!==d)throw this.error;if(this.data===d)throw this.promise;return this.data}}const l=t=>{const[e,r]=I.useState(null);return{future:e,mutate:(...i)=>{const o=new x(()=>t(...i));return r(o),o.toPromise()}}},O=()=>{const t=l(async s=>{var u;const i=await h.post("/cart-items",{productId:s}).acceptOrThrow(201);return Number((u=String(i.headers.location).match(/(\d+)$/))==null?void 0:u.at(0))}),e=l(async(s,i)=>{await h.patch(p("/cart-items/:cartItemId",s),{quantity:i}).acceptOrThrow(200)}),r=l(async s=>{await h.delete(p("/cart-items/:cartItemId",s)).acceptOrThrow(204)});return{createCartItem:t,updateCartItemQuantity:e,deleteCartItem:r}},E=()=>{const[t,e]=y(b),{createCartItem:r,updateCartItemQuantity:s,deleteCartItem:i}=O(),o=I.useCallback(c=>t.find(a=>a.product.id===c)??null,[t]),u=I.useCallback(async(c,a)=>{const n=o(c.id);if(a<=0){n&&i.mutate(n.id),e(m=>m.filter(C=>C.product.id!==c.id));return}if(n){s.mutate(n.id,a),e(t.map(m=>m.id===n.id?{...m,quantity:a}:m));return}const w=await r.mutate(c.id);e([...t,{id:w,product:c,quantity:a,unselectedForOrder:!1}])},[t,e,o,r,s,i]),{mutate:f}=l(async c=>{e(a=>a.filter(n=>!c.includes(n.id))),await Promise.all(c.map(a=>h.delete(p("/cart-items/:cartItemId",a)).acceptOrThrow(204)))});return{cartItems:t,findCartItemByProductId:o,setQuantity:u,deleteCartItems:f}};export{E as u};
//# sourceMappingURL=useCartActions-826dca1a.js.map
